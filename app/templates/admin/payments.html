{% extends "admin_base.html" %}
{% block title %}Pengaturan Pembayaran{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <div>
        <h1 class="text-2xl font-bold">Metode Pembayaran</h1>
        <p class="text-slate-500">Kelola rekening bank atau metode pembayaran lainnya.</p>
    </div>
    <div class="flex gap-2">
        <button onclick="openSettingsModal()" class="bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-200 px-4 py-2 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            Pengaturan Batas Waktu
        </button>
        <button onclick="openModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            Tambah Rekening
        </button>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for payment in payments %}
    <div class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 relative group">
        <div class="flex justify-between items-start mb-4">
            <div class="p-3 bg-slate-100 dark:bg-slate-700 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
            </div>
            <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                <!-- Toggle Status (Example Only) -->
                <span class="text-xs px-2 py-1 rounded {{ 'bg-green-100 text-green-700' if payment.is_active else 'bg-red-100 text-red-700' }}">
                    {{ 'Aktif' if payment.is_active else 'Nonaktif' }}
                </span>
            </div>
        </div>
        
        <h3 class="text-lg font-bold">{{ payment.bank_name }}</h3>
        <p class="text-slate-500 text-sm mb-4">{{ payment.account_holder }}</p>
        
        <div class="bg-slate-50 dark:bg-slate-900 p-3 rounded font-mono text-lg tracking-wider text-center border border-slate-200 dark:border-slate-700">
            {{ payment.account_number }}
        </div>
        
        <div class="mt-4 flex justify-end">
            <form action="{{ url_for('main.delete_payment', id=payment.id) }}" method="POST" onsubmit="return confirm('Hapus metode pembayaran ini?');">
                <button type="submit" class="text-red-500 hover:text-red-600 text-sm flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    Hapus
                </button>
            </form>
        </div>
    </div>
    {% else %}
    <div class="col-span-full p-12 text-center bg-white dark:bg-slate-800 rounded-lg border border-dashed border-slate-300 dark:border-slate-600">
        <p class="text-slate-500">Belum ada metode pembayaran yang ditambahkan.</p>
    </div>
    {% endfor %}
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 backdrop-blur-sm opacity-0 transition-opacity duration-300">
    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl w-full max-w-md shadow-2xl transform scale-95 transition-transform duration-300" id="settingsModalContent">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">Pengaturan Batas Waktu</h2>
            <button onclick="closeSettingsModal()" class="text-slate-400 hover:text-slate-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        
        <form action="{{ url_for('main.update_payment_settings') }}" method="POST" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Batas Waktu Pembayaran (Menit)</label>
                <p class="text-xs text-slate-500 mb-2">Order akan otomatis kedaluwarsa jika tidak dibayar dalam waktu ini.</p>
                <input name="payment_timeout_minutes" type="number" min="1" value="{{ site.payment_timeout_minutes }}" required class="w-full p-2 border rounded-lg bg-transparent focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div class="pt-2 flex justify-end gap-2">
                <button type="button" onclick="closeSettingsModal()" class="px-4 py-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors">Batal</button>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Simpan Pengaturan</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal -->
<div id="paymentModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 backdrop-blur-sm opacity-0 transition-opacity duration-300">
    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl w-full max-w-md shadow-2xl transform scale-95 transition-transform duration-300" id="modalContent">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">Tambah Rekening Baru</h2>
            <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        
        <form action="{{ url_for('main.add_payment') }}" method="POST" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Nama Bank / E-Wallet</label>
                <input name="bank_name" required placeholder="Contoh: BCA, Mandiri, GoPay" class="w-full p-2 border rounded-lg bg-transparent focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Nomor Rekening</label>
                <input name="account_number" required placeholder="Contoh: 1234567890" class="w-full p-2 border rounded-lg bg-transparent focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Atas Nama</label>
                <input name="account_holder" required placeholder="Nama Pemilik Rekening" class="w-full p-2 border rounded-lg bg-transparent focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div class="pt-2 flex justify-end gap-2">
                <button type="button" onclick="closeModal()" class="px-4 py-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors">Batal</button>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Simpan</button>
            </div>
        </form>
    </div>
</div>

<script>
    const modal = document.getElementById('paymentModal');
    const modalContent = document.getElementById('modalContent');

    function openModal() {
        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modalContent.classList.remove('scale-95');
            modalContent.classList.add('scale-100');
        }, 10);
    }

    function closeModal() {
        modal.classList.add('opacity-0');
        modalContent.classList.remove('scale-100');
        modalContent.classList.add('scale-95');
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });

    // Settings Modal Scripts
    const settingsModal = document.getElementById('settingsModal');
    const settingsModalContent = document.getElementById('settingsModalContent');

    function openSettingsModal() {
        settingsModal.classList.remove('hidden');
        setTimeout(() => {
            settingsModal.classList.remove('opacity-0');
            settingsModalContent.classList.remove('scale-95');
            settingsModalContent.classList.add('scale-100');
        }, 10);
    }

    function closeSettingsModal() {
        settingsModal.classList.add('opacity-0');
        settingsModalContent.classList.remove('scale-100');
        settingsModalContent.classList.add('scale-95');
        setTimeout(() => {
            settingsModal.classList.add('hidden');
        }, 300);
    }
    
    settingsModal.addEventListener('click', (e) => {
        if (e.target === settingsModal) closeSettingsModal();
    });
</script>
{% endblock %}