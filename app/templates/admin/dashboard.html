{% extends "admin_base.html" %}
{% block content %}
    <h1 class="text-2xl font-bold mb-6">Dashboard Overview</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Stats Cards -->
        <div class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 relative overflow-hidden group">
            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
            </div>
            <h3 class="text-slate-500 dark:text-slate-400 text-sm font-medium uppercase tracking-wider">Total Pendapatan</h3>
            <p class="text-3xl font-bold mt-2 text-green-600 dark:text-green-400">Rp {{ "{:,}".format(total_revenue) }}</p>
        </div>
        
        <div class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 relative overflow-hidden group">
            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            </div>
            <h3 class="text-slate-500 dark:text-slate-400 text-sm font-medium uppercase tracking-wider">Total Pesanan</h3>
            <p class="text-3xl font-bold mt-2 text-blue-600 dark:text-blue-400">{{ total_orders }}</p>
        </div>
        
        <div class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 relative overflow-hidden group">
             <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            </div>
            <h3 class="text-slate-500 dark:text-slate-400 text-sm font-medium uppercase tracking-wider">Pesanan Hari Ini</h3>
            <p class="text-3xl font-bold mt-2 text-purple-600 dark:text-purple-400">{{ today_orders }}</p>
        </div>
    </div>

    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700">
        <div class="p-6 border-b border-slate-200 dark:border-slate-700">
            <h3 class="font-bold text-lg">Transaksi Terbaru</h3>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm">
                <thead class="bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700">
                    <tr>
                        <th class="px-6 py-4 font-semibold">ID</th>
                        <th class="px-6 py-4 font-semibold">Tanggal</th>
                        <th class="px-6 py-4 font-semibold">Total</th>
                        <th class="px-6 py-4 font-semibold">Waktu</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
                    {% for order in recent_orders %}
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-900/50">
                        <td class="px-6 py-4 font-mono">#{{ order.id }}</td>
                        <td class="px-6 py-4">{{ order.visit_date }}</td>
                        <td class="px-6 py-4 font-bold">Rp {{ "{:,}".format(order.total_price) }}</td>
                        <td class="px-6 py-4 text-slate-500">{{ order.created_at.strftime('%d %b, %H:%M') }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" class="p-6 text-center text-slate-500">Belum ada data.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-center">
            <a href="{{ url_for('main.admin_transactions') }}" class="text-blue-600 hover:underline text-sm font-medium">Lihat Semua Transaksi &rarr;</a>
        </div>
    </div>

    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 mt-8">
        <div class="p-6 border-b border-slate-200 dark:border-slate-700">
            <h3 class="font-bold text-lg">Check-in Terbaru</h3>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm">
                <thead class="bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700">
                    <tr>
                        <th class="px-6 py-4 font-semibold">Invoice</th>
                        <th class="px-6 py-4 font-semibold">Nama</th>
                        <th class="px-6 py-4 font-semibold">Waktu Check-in</th>
                        <th class="px-6 py-4 font-semibold">Tipe</th>
                        <th class="px-6 py-4 font-semibold">Gate</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
                    {% for checkin in recent_checkins %}
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-900/50">
                        <td class="px-6 py-4 font-mono text-xs">{{ checkin.invoice_number }}</td>
                        <td class="px-6 py-4">{{ checkin.customer_name }}</td>
                        <td class="px-6 py-4 font-mono text-slate-500">
                            {% if checkin.checkin_at %}
                                {{ checkin.checkin_at.strftime('%H:%M') }}
                            {% elif checkin.wristband_at %}
                                {{ checkin.wristband_at.strftime('%H:%M') }}
                            {% endif %}
                        </td>
                        <td class="px-6 py-4">
                            {% if checkin.checkin_at and checkin.wristband_at %}
                                <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs">Both</span>
                            {% elif checkin.checkin_at %}
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Gate</span>
                            {% elif checkin.wristband_at %}
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs">Gelang</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 text-slate-500">
                            {{ checkin.checkin_gate or '-' }}
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" class="p-6 text-center text-slate-500">Belum ada data check-in hari ini.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}