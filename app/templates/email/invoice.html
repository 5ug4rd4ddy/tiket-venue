{% extends "email/base_email.html" %}

{% block title %}Invoice #{{ order.invoice_number }}{% endblock %}

{% block content %}
<h2>Halo {{ order.customer_name }},</h2>
<p>Terima kasih atas pesanan Anda. Berikut adalah detail tagihan Anda:</p>

<table class="info-table">
    <tr>
        <th>No. Invoice</th>
        <td>{{ order.invoice_number }}</td>
    </tr>
    <tr>
        <th>Tanggal Kunjungan</th>
        <td>{{ order.visit_date | date_with_day }}</td>
    </tr>
    <tr>
        <th>Metode Pembayaran</th>
        <td style="text-transform: uppercase;">{{ order.payment_method.replace('_', ' ') }}</td>
    </tr>
    <tr>
        <th>Total Tagihan</th>
        <td style="font-size: 18px; color: #2563eb;">Rp {{ "{:,.0f}".format(order.total_price).replace(',', '.') }}</td>
    </tr>
    <tr>
        <th>Status Pembayaran</th>
        <td>
            {% if order.payment_status == 'paid' %}
            <span style="color: #10b981; font-weight: bold;">LUNAS</span>
            {% elif order.payment_status == 'pending' %}
            <span style="color: #f59e0b; font-weight: bold;">MENUNGGU PEMBAYARAN</span>
            {% else %}
            <span style="color: #ef4444; font-weight: bold;">GAGAL</span>
            {% endif %}
        </td>
    </tr>
    {% if order.payment_status == 'pending' and order.expires_at %}
    <tr>
        <th>Batas Waktu Pembayaran</th>
        <td style="color: #ef4444; font-weight: bold;">
            {{ order.expires_at | wib_format }}
        </td>
    </tr>
    {% endif %}
</table>

<h3>Rincian Pesanan</h3>
<table class="info-table" style="font-size: 14px;">
    <tr style="background-color: #f8fafc;">
        <th style="padding: 10px;">Item</th>
        <th style="padding: 10px; text-align: center;">Qty</th>
        <th style="padding: 10px; text-align: right;">Subtotal</th>
    </tr>
    {% for item in details.get('items', []) %}
    <tr>
        <td>{{ item.name }}</td>
        <td style="text-align: center;">{{ item.qty }}</td>
        <td style="text-align: right;">Rp {{ "{:,.0f}".format(item.subtotal).replace(',', '.') }}</td>
    </tr>
    {% endfor %}
    {% for item in details.get('addons', []) %}
    <tr>
        <td>{{ item.name }}</td>
        <td style="text-align: center;">1</td>
        <td style="text-align: right;">Rp {{ "{:,.0f}".format(item.price).replace(',', '.') }}</td>
    </tr>
    {% endfor %}
    {% if order.discount_amount > 0 %}
    <tr>
        <td colspan="2" style="text-align: right; color: #64748b;">Diskon ({{ order.promo_code or 'Partner' }})</td>
        <td style="text-align: right; color: #ef4444;">- Rp {{ "{:,.0f}".format(order.discount_amount).replace(',', '.')
            }}</td>
    </tr>
    {% endif %}
    <tr style="font-weight: bold; font-size: 16px;">
        <td colspan="2" style="text-align: right;">TOTAL</td>
        <td style="text-align: right; color: #2563eb;">Rp {{ "{:,.0f}".format(order.total_price).replace(',', '.') }}
        </td>
    </tr>
</table>

{% if order.payment_status == 'pending' %}
<p>Silakan selesaikan pembayaran Anda melalui tautan di bawah ini:</p>
<div style="text-align: center; color: #fff;">
    <a href="{{ url_for('main.payment_page', uuid=order.uuid, _external=True) }}" class="btn" style="color: #fff;">Bayar
        Sekarang</a>
</div>
<p style="font-size: 14px; color: #64748b; margin-top: 20px; text-align: center;">Atau salin tautan berikut: <br>{{
    url_for('main.payment_page', uuid=order.uuid, _external=True) }}</p>
{% else %}
<p>Pembayaran Anda telah kami terima. E-Ticket telah dikirimkan ke email Anda.</p>
<div style="text-align: center;">
    <a href="{{ url_for('main.payment_page', uuid=order.uuid, _external=True) }}" class="btn">Lihat Detail Pesanan</a>
</div>
{% endif %}
{% endblock %}